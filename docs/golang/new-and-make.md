---
next: false
prev:
  text: 'Garbage Collection'
  link: '/golang/garbage-collection'
---


# `new`和`make`的区别

<br>

在 Go 语言中，`new` 和 `make` 都是用来分配内存的关键字，但它们有不同的用途和适用场景。

### 1. **`new`**

- **用途**：`new` 用于为类型分配内存并返回一个指向该类型的指针。它会初始化为该类型的零值（零值就是该类型的默认值）。
- **返回类型**：`new` 返回的是指向新分配对象的指针，即 `*T` 类型。
- **使用场景**：当你需要一个指针，且希望它指向类型的零值时使用 `new`。

#### **示例：**

```go
package main

import "fmt"

func main() {
    // 使用 new 分配内存并返回指针
    p := new(int) // 返回指向 int 类型的指针
    fmt.Println(*p) // 输出 0，int 类型的零值

    *p = 42 // 修改内存中的值
    fmt.Println(*p) // 输出 42
}

```

在这个示例中，`new(int)` 返回一个指向 `int` 类型的指针，且初始值为 `0`，即 `int` 的零值。

### 2. **`make`**

- **用途**：`make` 用于初始化并分配内存空间，对于切片、映射（`map`）、和通道（`chan`
  ）这三种类型。它不仅仅是分配内存，还会初始化数据结构所需的额外信息，例如数组的长度和容量。
- **返回类型**：`make` 返回的是初始化后的数据结构本身（例如切片、映射或通道），而不是指向该数据结构的指针。
- **使用场景**：当你需要初始化切片、映射或通道时，使用 `make`。这些类型在创建时除了分配内存，还需要一些额外的信息来指定容量、大小等。

#### **示例：**

```go
package main

import "fmt"

func main() {
    // 使用 make 创建一个切片
    s := make([]int, 5, 10) // 长度为 5，容量为 10
    fmt.Println(s)           // 输出: [0 0 0 0 0]

    // 使用 make 创建一个映射
    m := make(map[string]int)
    m["age"] = 30
    fmt.Println(m)           // 输出: map[age:30]

    // 使用 make 创建一个通道
    ch := make(chan int, 2)
    ch <- 1
    ch <- 2
    fmt.Println(<-ch)        // 输出: 1
    fmt.Println(<-ch)        // 输出: 2
}

```

在这个示例中，`make` 用于初始化切片、映射和通道。

### 3. **`new` 和 `make` 的区别总结**

| 特性       | `new`                | `make`                      |
|----------|----------------------|-----------------------------|
| **用法**   | 用于创建任何类型的零值并返回指针     | 用于创建并初始化切片、映射、通道            |
| **返回值**  | 返回类型的指针 `*T`         | 返回初始化后的数据结构本身（切片、映射、通道）     |
| **适用类型** | 适用于任何类型的值，除了切片、映射、通道 | 仅适用于切片、映射和通道                |
| **初始化**  | 仅为值分配内存并初始化为零值       | 为数据结构分配内存并初始化相关结构（如切片长度、容量） |

### 4. **什么时候使用 `new` 和 `make`**

- 使用 `new`：

    - 当你需要一个类型的零值并且你需要一个指向该类型的指针时使用 `new`。
    - 适用于基本数据类型，如 `int`、`struct`，或者任何你需要指针的类型。
- 使用 `make`：

    - 当你需要创建并初始化切片、映射或通道时使用 `make`。
    - 特别是当你需要指定切片的长度和容量，或者映射的初始容量，或者通道的缓冲区大小时。

### 5. **总结**

- **`new`** 用于创建任何类型的指针，并初始化为该类型的零值。
- **`make`** 用于创建和初始化切片、映射和通道，返回的是它们本身，而不是指针。